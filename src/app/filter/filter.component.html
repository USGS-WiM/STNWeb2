<mat-expansion-panel [(expanded)]="filtersPanelState">
    <mat-expansion-panel-header>
        <mat-panel-title>
            Filters <span class="fal fa-home-alt"></span
        ></mat-panel-title>
    </mat-expansion-panel-header>
    <div class="form-container">
        <form class="form" [formGroup]="mapFilterForm">
            <mat-form-field appearance="fill">
                <mat-label for="eventType">Event Type</mat-label>
                <mat-select
                    id="eventTypeOptions"
                    formControlName="eventTypeControl"
                    (selectionChange)="updateEventFilter()"
                >
                    <mat-option
                        *ngFor="let eventType of eventTypes$ | async"
                        [value]="eventType"
                        >{{ eventType.type }}</mat-option
                    >
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill">
                <mat-label for="eventType">Event State</mat-label>
                <input
                    matInput
                    id="eventStateOptions"
                    type="text"
                    aria-label="Dropdown menu for state selection"
                    matInput
                    formControlName="eventStateControl"
                    [matAutocomplete]="eventStateAutocomplete"
                />
                <mat-hint>Start typing for suggestions</mat-hint>
                <mat-autocomplete
                    #eventStateAutocomplete="matAutocomplete"
                    [displayWith]="displayEventState"
                >
                    <mat-option
                        *ngFor="let eventState of eventStates$ | async"
                        (click)="updateEventFilter()"
                        [value]="eventState"
                        >{{ eventState.state_name }}</mat-option
                    >
                </mat-autocomplete>
            </mat-form-field>

            <br />

            <mat-form-field class="eventSelect">
                <mat-label for="eventSelection">Event</mat-label>
                <input
                    matInput
                    id="eventSelection"
                    type="text"
                    aria-label="Dropdown menu for storm event selection"
                    matInput
                    formControlName="eventsControl"
                    [matAutocomplete]="eventAutocomplete"
                />
                <mat-hint>Start typing for suggestions</mat-hint>
                <mat-autocomplete
                    #eventAutocomplete="matAutocomplete"
                    [displayWith]="displayEvent"
                >
                    <mat-option
                        *ngFor="let event of filteredEvents$ | async"
                        [value]="event"
                    >
                        {{ event.event_name }}
                    </mat-option>
                </mat-autocomplete>
            </mat-form-field>
            <br />
            <mat-form-field appearance="fill">
                <mat-label for="networkOptions">Networks</mat-label>
                <mat-select
                    id="networkOptions"
                    formControlName="networkControl"
                    multiple
                >
                    <mat-option
                        *ngFor="let network of networks$ | async"
                        [value]="network.network_name_id"
                        >{{ network.name }}</mat-option
                    >
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label for="sensorTypes">Sensor Types</mat-label>
                <mat-select
                    id="sensorOptions"
                    formControlName="sensorTypeControl"
                >
                    <mat-option>Any</mat-option>
                    <mat-option
                        *ngFor="let sensorType of sensorTypes$ | async"
                        [value]="sensorType.sensor_type_id"
                        >{{ sensorType.sensor }}</mat-option
                    >
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill">
                <mat-label for="stateList">States</mat-label>
                <input
                    matInput
                    type="text"
                    aria-label="Dropdown menu for state selection"
                    matInput
                    formControlName="stateControl"
                    [matAutocomplete]="stateAutocomplete"
                />
                <mat-hint>Start typing for suggestions</mat-hint>
            </mat-form-field>
            <mat-autocomplete
                #stateAutocomplete="matAutocomplete"
                [displayWith]="displayState"
            >
                <mat-option
                    *ngFor="let state of states$ | async"
                    [value]="state.state_abbrev"
                >
                    <div>
                        <mat-checkbox
                            [checked]="state.selected"
                            (change)="toggleStateSelection(state)"
                            (click)="$event.stopPropagation()"
                        >
                            {{ state.state_name }}
                        </mat-checkbox>
                    </div>
                </mat-option>
            </mat-autocomplete>

            <label id="selectedStateList"> </label>

            <br />
            <label
                class="filter-label"
                aria-label="Optionally select surveyed or unsurveyed HWMS"
                >HWMS Surveyed:</label
            >
            <mat-radio-group
                aria-label="Select an option"
                class="checkbox-section"
                formControlName="surveyedControl"
            >
                <mat-radio-button value="true">Surveyed</mat-radio-button>
                <mat-radio-button value="false">Unsurveyed</mat-radio-button>
            </mat-radio-group>
            <br />
            <label
                class="filter-label"
                aria-label="Optionally select additional site filters"
                >Additional Site Filters:</label
            >
            <section class="checkbox-section">
                <mat-checkbox
                    aria-checked="false"
                    class="checkbox-margin"
                    formControlName="HWMOnlyControl"
                    >HWM Only Sites</mat-checkbox
                >
                <mat-checkbox
                    aria-checked="false"
                    class="checkbox-margin"
                    formControlName="sensorOnlyControl"
                    >Sensor Only Sites</mat-checkbox
                >
                <mat-checkbox
                    aria-checked="false"
                    class="checkbox-margin"
                    formControlName="surveyedOnlyControl"
                    >Surveyed RP Only Sites</mat-checkbox
                >
                <mat-checkbox
                    aria-checked="false"
                    class="checkbox-margin"
                    formControlName="bracketSiteOnlyControl"
                    >Pre-Deployed Bracket Sites Only</mat-checkbox
                >
                <mat-checkbox
                    aria-checked="false"
                    class="checkbox-margin"
                    formControlName="RDGOnlyControl"
                    >RDG Only Sites</mat-checkbox
                >
                <mat-checkbox
                    aria-checked="false"
                    class="checkbox-margin"
                    formControlName="OPDefinedControl"
                    >Has OP Defined</mat-checkbox
                >
            </section>
        </form>
        <div class="button-row">
            <button
                mat-raised-button
                color="accent"
                type="submit"
                aria-label="Filter Sites"
                (click)="submitMapFilter()"
            >
                <mat-icon>filter_alt</mat-icon>&nbsp;Filter Sites
            </button>
            <button
                mat-raised-button
                color="warn"
                type="reset"
                aria-label="Clear filters"
                (click)="clearMapFilterForm()"
            >
                <mat-icon>clear_all</mat-icon>&nbsp;Clear Filters
            </button>
        </div>
    </div>
</mat-expansion-panel>
